---
// src/pages/barberia/[slug].astro
export const prerender = false;

import BarberiaLayout from "../../layouts/BarberiaLayout.astro";
import NavbarBarberia from "../../components/barberia/NavbarBarberia";
import HeroBarberia from "../../components/barberia/HeroBarberia";
import { db } from "../../lib/firebase";
import { collection, query, where, getDocs } from "firebase/firestore";

// ğŸ“Œ Obtenemos el slug desde la URL
const { slug } = Astro.params;

// ğŸ“Œ Buscamos el negocio en Firestore
let negocio = null;
const q = query(collection(db, "Negocios"), where("slug", "==", slug));
const snap = await getDocs(q);

if (!snap.empty) {
  negocio = snap.docs[0].data();
}

// ğŸ“Œ Variables dinÃ¡micas (ej: colores)
const hoverColor = negocio?.hoverColor || "#3b82f6";

// ğŸ¨ Estilos dinÃ¡micos
const css = `
  :root {
    --hoverColor: ${hoverColor};
  }

  .negocio a,
  .negocio button {
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .negocio a:hover,
  .negocio button:hover {
    background-color: var(--hoverColor);
    color: white;
    border-color: var(--hoverColor);
  }
`;
---

{!negocio ? (
  <h1 class="text-center text-2xl mt-10">âŒ Este negocio no existe.</h1>
) : (
  <BarberiaLayout title={negocio.nombre}>
    <!-- ğŸ¨ Inyectar estilos dinÃ¡micos -->
    <style is:global set:html={css} />

    <!-- âœ… Navbar dinÃ¡mico -->
    <NavbarBarberia
      title={negocio.nombre}
      hoverColor={hoverColor}
      logoUrl={negocio.usarLogo ? negocio.logoUrl : null}
      client:load
    />

    <!-- ğŸ¯ HERO personalizado -->
    <HeroBarberia
      images={[
        "/img/1.jpeg",
        "/img/2.jpg",
        "/img/3.jpg"
      ]}
    />

    <!-- ğŸ¯ BOTONES DE ACCIÃ“N -->
    <section class="negocio space-y-6 mt-6 p-6 border rounded bg-white shadow-sm">
      <a href="#servicios" class="inline-block px-4 py-2 border rounded font-medium">
        Ver servicios
      </a>
      <button class="px-4 py-2 border rounded font-medium">
        Reservar turno
      </button>
    </section>

    <!-- ğŸ¯ PROMOCIONES -->
    <section class="negocio mt-8 grid md:grid-cols-2 gap-4">
      <div class="border p-4 rounded shadow-sm hover:shadow-md">
        <h3 class="font-bold mb-2">ğŸ”¥ Promo destacada</h3>
        <p>{negocio.promo || "Primera visita con 20% de descuento"}</p>
      </div>
      <div class="border p-4 rounded shadow-sm hover:shadow-md">
        <h3 class="font-bold mb-2">â­ Servicios mÃ¡s populares</h3>
        <p>Corte + barba, Tinte, Peinados</p>
      </div>
    </section>
  </BarberiaLayout>
)}
